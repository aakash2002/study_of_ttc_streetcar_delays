---
title: "Annual Analysis of Delays in TTC Streetcars for the year 2023"
subtitle: "Is there a way to make commuter life easier?"
author: 
  - Aakash Vaithyanathan
thanks: "Code and data are available at: https://github.com/aakash2002/study_of_ttc_streetcar_delays"
date: today
date-format: long
abstract: "First sentence. Second sentence. Third sentence. Fourth sentence."
format: pdf
number-sections: true
bibliography: references.bib
---

```{r}
#| include: false
#| warning: false
#| message: false

library(tidyverse)
library(ggplot2)

data <- read_csv(here::here("data/analysis_data/cleaned_ttc_streetcar_delay_2023.csv"))
```


# Introduction

Toronto Transit Commission (TTC) is the biggest and most used transit authority in Toronto. It was established on September 1, 1921 and since then supports various means of ground transportation like streetcar, shuttle bus and the subway system. Despite being the most used transit system, it does come with several challenges one of the most notable one being the delays experienced between the various stops. One such transportation system we focus on in this paper is streetcars.

These delays make it especially difficult for individuals that commute on a daily basis. Furthermore, one can image the inconveniences caused due to extended delays by streetcars during weather conditions like the winter months. In this paper, we aim to dive deeper into the cause of delays in TTC, how these vary by the times of day and the various seasons and what incidents are the most occurring for the delays experienced. We make use of the dataset made available by @opendatatoronto for the year 2023.

The remainder of this paper is structured as follows. We first give a brief overview of the dataset under @dataset-desc. Then, we present some graphs on the results extracted from our collected data found under @results. Lastly, we conclude with a discussion of our results and any limitations in our approach found under @discussion.

# Dataset Description {#dataset-desc}

bla bla bla

# Results {#results}
## Average Delay By Streetcar Line
```{r}
#| include: true
#| warning: false
#| message: false
#| echo: false
#| label: fig-delay-by-line
#| fig-cap: Average annual delay in minutes for each streetcar line

# Grouping and summarizing the data
grp_data <- data |> 
  group_by(line) |>
  summarise(average_delay = mean(min_delay), .groups = 'drop')

# Create the bar plot
ggplot(grp_data, aes(x = factor(line), y = average_delay)) +
  geom_bar(stat = "identity", width = 0.7, fill = 'lightblue') +
  geom_text(aes(label = round(average_delay, 2)), 
            vjust = -0.5,  # Position the text above the bar
            size = 2) +  # Adjust the size of the text
  ggtitle("Bar plot of average delay in minutes by line") +
  xlab("Streetcar Line") +
  ylab("Average Delay in Minutes") +
  theme_minimal() + 
  theme(axis.text.x = element_text(angle = 45, hjust = 1),
        title = element_text(hjust = 0.5))

```

@fig-delay-by-line highlights the annual average delay in minutes for every streetcar line for the year 2023. The 300-series lines also called the Blue Network Lines (cite) are the nighttime streetcar lines that start at 1:30 AM. These buses average the most delays reaching at most 30 minutes for line 312.

The 500-series lines are the daytime lines that run from 8 AM. These buses average between 6 to 23.6 minutes with the longest delay experienced by line 507.

## Average Delay By Working Shift
### Delays During Dayshift
```{r}
#| label: fig-delay-dayshift
#| fig-cap: Average delay in minutes for dayshift
#| echo: false
#| warning: false
#| message: false

# Filter the data for times between 08:00 and 18:00 i.e day shift
avg_delay_day_shift <- data |> 
  group_by(hour) |>
  summarise(average_delay = mean(min_delay), .groups = 'drop') |>
  filter(hour >= "08" & hour <= "18")

ggplot(avg_delay_day_shift, aes(x = hour, y = average_delay)) +
  geom_line(color = "red", size = 1) +
  geom_point(color = "blue", size = 2) +
  geom_text(aes(label = round(average_delay, 2)), 
            vjust = -1, 
            size = 2) + 
  ggtitle("Average delay in minutes for morning shift") +
  xlab("Hour of Day") +
  ylab("Average Delay (Minutes)") +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5),
    axis.text.x = element_text(angle = 45, hjust = 1)  # Rotate x-axis labels for clarity
  )
```

@fig-delay-dayshift highlights the annual average delay in minutes experienced by the hour of day for streetcars that run during the day. We observe that there is high variability in the delays throughout the day with the minimum delay being about 13.78 minutes and the maximum being roughly 20 minutes.

### Delays During Nightshift
```{r}
#| label: fig-delay-nightshift
#| fig-cap: Average delay in minutes for nightshift
#| echo: false
#| warning: false
#| message: false

# Filter the data for times between 19:00 and 00:00 i.e night shift
avg_delay_night_shift <- data |> 
  group_by(hour) |>
  summarise(average_delay = mean(min_delay), .groups = 'drop') |>
  filter(hour >= "19" | hour <= "01")

# Specify the desired order for the hours (military time format)
hour_order <- c("17", "18", "19", "20", "21", "22", "23", "00", "01")

# Convert the 'hour' column to a factor with the specified order
avg_delay_night_shift$hour <- factor(avg_delay_night_shift$hour, levels = hour_order)

# Plot the graph with the reordered x-axis
ggplot(avg_delay_night_shift, aes(x = hour, y = average_delay)) +
  geom_line(color = "blue", size = 1) +
  geom_point(color = "red", size = 2) +
  geom_text(aes(label = round(average_delay, 2)), 
            vjust = -1, 
            size = 2) + 
  ggtitle("Average delay in minutes for night shift") +
  xlab("Hour of Day") +
  ylab("Average Delay (Minutes)") +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5),
    axis.text.x = element_text(angle = 45, hjust = 1)  # Rotate x-axis labels for clarity
  )
```

@fig-delay-nightshift highlights the annual average delay in minutes experienced by the hour of day for streetcars that run during the night We observe that there is low variability in the delays throughout the night with the minimum delay being about 16.62 minutes and the maximum roughly 20 minutes.

## Frequency of delays by incidents
```{r}
#| label: fig-freq-delay-incidents
#| fig-cap: Frequency plot for cause of streetcar delay by incidents
#| echo: false
#| warning: false
#| message: false

freq_incidence <- data |> 
  group_by(incident) |> 
  summarise(frequency = n(), .groups = 'drop')

ggplot(freq_incidence, aes(x = incident, y = frequency)) +
  geom_bar(stat = "identity", fill = "lightblue") +
  geom_text(aes(label = frequency), 
            vjust = -0.5,  # Position the text above the bar
            size = 2) +  # Adjust the size of the text
  ggtitle("Frequency of each delay incident in the year 2023") +
  xlab("Delay Incident Type") +
  ylab("Frequency") +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5),  # Center title
    axis.text.x = element_text(angle = 45, hjust = 1)  # Rotate x-axis labels for clarity
  )
```



```{r}
#| label: fig-min-delay-by-season
#| fig-cap: Average delay in minutes by seasons in a yea
#| echo: false
#| warning: false
#| message: false

delay_by_season <- data |>
  group_by(season) |>
  summarise(average_delay = mean(min_delay), .groups = 'drop')

ggplot(delay_by_season, aes(x = season, y = average_delay)) +
  geom_bar(stat = "identity", fill = "lightblue") +
  ggtitle("Average delay in minutes by seasons in a year") +
  xlab("Type of Season") +
  ylab("Average delay in minutes") +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5),  # Center title
    axis.text.x = element_text(angle = 45, hjust = 1)  # Rotate x-axis labels for clarity
  )
```

# Discussion {#discussion}

## First discussion point {#sec-first-point}

If my paper were 10 pages, then should be be at least 2.5 pages. The discussion is a chance to show off what you know and what you learnt from all this. 

## Second discussion point

## Third discussion point

## Weaknesses and next steps

Weaknesses and next steps should also be included.

\newpage

\appendix

# Appendix {-}


# Additional data details

\newpage


# References


