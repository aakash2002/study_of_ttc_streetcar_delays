---
title: "Annual Analysis of Delays in TTC Streetcars for the year 2023"
subtitle: "Is there a way to make commuter life easier?"
author: 
  - Aakash Vaithyanathan
thanks: "Code and data are available at: https://github.com/aakash2002/study_of_ttc_streetcar_delays"
date: today
date-format: long
abstract: "First sentence. Second sentence. Third sentence. Fourth sentence."
format: pdf
number-sections: true
bibliography: references.bib
---

```{r}
#| include: false
#| warning: false
#| message: false

library(tidyverse)
library(ggplot2)

data <- read_csv(here::here("data/analysis_data/cleaned_ttc_streetcar_delay_2023.csv"))
```


# Introduction

Toronto Transit Commission (TTC) is the biggest and most used transit authority in Toronto. It was established on September 1, 1921 and since then supports various means of ground transportation like streetcar, shuttle bus and the subway system. Despite being the most used transit system, it does come with several challenges one of the most notable one being the delays experienced between the various stops. One such transportation system we focus on in this paper is streetcars.

These delays make it especially difficult for individuals that commute on a daily basis. Furthermore, one can image the inconveniences caused due to extended delays by streetcars during weather conditions like the winter months. In this paper, we aim to dive deeper into the cause of delays in TTC, how these vary by the times of day and the various seasons and what incidents are the most occurring for the delays experienced. We make use of the dataset made available by @opendatatoronto for the year 2023.

The remainder of this paper is structured as follows. We first give a brief overview of the dataset under @dataset-desc. Then, we present some graphs on the results extracted from our collected data found under @results. Lastly, we conclude with a discussion of our results and any limitations in our approach found under @discussion.

# Dataset Description {#dataset-desc}

bla bla bla

# Results {#results}
## Average Delay By Streetcar Line
```{r}
#| include: true
#| warning: false
#| message: false
#| echo: false
#| label: fig-delay-by-line
#| fig-cap: Average annual delay in minutes for each streetcar line

# Grouping and summarizing the data
grp_data <- data |> 
  group_by(line) |>
  summarise(average_delay = mean(min_delay), .groups = 'drop')

# Create the bar plot
ggplot(grp_data, aes(x = factor(line), y = average_delay)) +
  geom_bar(stat = "identity", width = 0.7, fill = 'lightblue') +
  geom_text(aes(label = round(average_delay, 2)), 
            vjust = -0.5,  # Position the text above the bar
            size = 2) +  # Adjust the size of the text
  ggtitle("Average delay in minutes by streetcar line") +
  xlab("Streetcar Line") +
  ylab("Average Delay in Minutes") +
  theme_minimal() + 
  theme(axis.text.x = element_text(angle = 45, hjust = 1),
        title = element_text(hjust = 0.5))

```

@fig-delay-by-line highlights the annual average delay in minutes for every streetcar line for the year 2023. The 300-series lines also called the Blue Network Lines (cite) are the nighttime streetcar lines that start at 1:30 AM. These buses average the most delays reaching at most 30 minutes for line 312.

The 500-series lines are the daytime lines that run from 8 AM. These buses average between 6 to 23.6 minutes with the longest delay experienced by line 507.

## Average Delays During Dayshift
```{r}
#| label: fig-delay-dayshift
#| fig-cap: Average delay in minutes for dayshift
#| echo: false
#| warning: false
#| message: false

# Filter the data for times between 08:00 and 01:00 i.e day shift
avg_delay_day_shift <- data |> 
  group_by(hour) |>
  summarise(average_delay = mean(min_delay), .groups = 'drop') |>
  filter(hour >= "08" | hour <= "01")

ggplot(avg_delay_day_shift, aes(x = hour, y = average_delay)) +
  geom_line(color = "red", size = 1) +
  geom_point(color = "blue", size = 2) +
  geom_text(aes(label = round(average_delay, 2)), 
            vjust = -1, 
            size = 2) + 
  ggtitle("Average delay in minutes for morning shift") +
  xlab("Hour of Day") +
  ylab("Average Delay (Minutes)") +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5),
    axis.text.x = element_text(angle = 45, hjust = 1)  # Rotate x-axis labels for clarity
  )
```
@fig-delay-dayshift highlights the annual average delay in minutes experienced by the hour of day for streetcars that run during the day. We observe that there is high variability in the delays throughout the day with the minimum delay being about 13.78 minutes and the maximum being roughly 20 minutes.


## Average Delays During Nightshift
```{r}
#| label: fig-delay-nightshift
#| fig-cap: Average delay in minutes for nightshift
#| echo: false
#| warning: false
#| message: false

# Filter the data for times between 02:00 and 07:00 i.e night shift
avg_delay_night_shift <- data |> 
  group_by(hour) |>
  filter(hour >= "02" & hour <= "07") |>
  summarise(average_delay = mean(min_delay), .groups = 'drop')

# Plot the graph with the reordered x-axis
ggplot(avg_delay_night_shift, aes(x = hour, y = average_delay)) +
  geom_line(color = "blue", size = 1) +
  geom_point(color = "red", size = 2) +
  geom_text(aes(label = round(average_delay, 2)), 
            vjust = -1, 
            size = 2) + 
  ggtitle("Average delay in minutes for night shift") +
  xlab("Hour of Day") +
  ylab("Average Delay (Minutes)") +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5),
    axis.text.x = element_text(angle = 45, hjust = 1)  # Rotate x-axis labels for clarity
  )
```
@fig-delay-nightshift highlights the annual average delay in minutes experienced by the hour of day for streetcars that run during the night. We observe that there is decreasing trend in the delays throughout the night after 3 AM with the minimum delay being about 14 minutes and the maximum roughly 27 minutes.


## Frequency of delays by incidents
```{r}
#| label: fig-freq-delay-incidents
#| fig-cap: Frequency plot for cause of streetcar delay by incidents
#| echo: false
#| warning: false
#| message: false

freq_incidence <- data |> 
  group_by(incident) |> 
  summarise(frequency = n(), .groups = 'drop')

ggplot(freq_incidence, aes(x = incident, y = frequency)) +
  geom_bar(stat = "identity", fill = "lightblue") +
  geom_text(aes(label = frequency), 
            vjust = -0.5,  # Position the text above the bar
            size = 2) +  # Adjust the size of the text
  ggtitle("Frequency of each delay incident in the year 2023") +
  xlab("Delay Incident Type") +
  ylab("Frequency") +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5),  # Center title
    axis.text.x = element_text(angle = 45, hjust = 1)  # Rotate x-axis labels for clarity
  )
```
@fig-freq-delay-incidents highlights the total annual delays incurred based on incidents reported by TTC for the reason. We can see for the year of 2023, operation delays were the most frequently occurring including a total of 2463 instances and rail switches were the least occuring with reported instances being only about 20.

## Delay by Seasons
```{r}
#| label: fig-delay-by-season
#| fig-cap: Average delay in minutes by seasons in a yea
#| echo: false
#| warning: false
#| message: false

delay_by_season <- data |>
  group_by(season) |>
  summarise(average_delay = mean(min_delay), .groups = 'drop')

ggplot(delay_by_season, aes(x = season, y = average_delay)) +
  geom_bar(stat = "identity", fill = "lightblue") +
  ggtitle("Average delay in minutes by seasons in a year") +
  xlab("Type of Season") +
  ylab("Average delay in minutes") +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5),  # Center title
    axis.text.x = element_text(angle = 45, hjust = 1)  # Rotate x-axis labels for clarity
  )
```

@fig-delay-by-season highlights the annual average delay in minutes based on the seasons. We observe that were isn't as much variation between the streetcar delays between the fall, spring, summer and winter months with each averaging around 16 minutes delay.

# Discussion {#discussion}
The above analysis provide valuable information regarding causes for TTC streetcar delays. Let us take a closer look into each of these.
## Delays by bus lines
The results from @fig-delay-by-line shows that blue-network (night shift) buses incur the highest average delay. This result makes sense as compared to the day shift buses, there are far fewer night shift buses resulting in fewer drivers for various locations the buses may take. Additionally, we also note that the 900-series streetcar line that go to the Airport incur the longest average delay of almost 54 minutes.

## Average delay for morning shift
The results from @fig-delay-dayshift showcases the variability in average delays by the hour during the morning shift working hours observed between 8 AM to 6 PM. We observe that the results are in-line with the expected behavior of longer average delays of around 18 minutes during peak hours like 8 AM or 5 PM which is usually when a large working population leave and return from work. This can result in higher traffic hours on average causing an expected delay in streetcar arrivals. Additionally, we notice that throughout the day there are several points of interest for peak delays as seen at 11 AM or 1 PM incurring an average delay of 19 minutes. This observation could indicate the need for travel to various locations like grocery stores, perhaps to a friend's house or classes for university students. During these hours, there is heavy traffic and these suggest a potential reason for delays.

## Average delay for night shift
The results from @fig-delay-nightshift shows a decreasing trend in the average delays by the hour during the night shift working hours observed between 2 AM to 7 AM. These findings are what we might expect as there is fewer traffic delays during the night resulting in a more consistent decreasing delay pattern. A possible reason for longer delay duration despite fewer traffic could be the fact there there are far fewer blue-network (night shift) buses that run resulting in fewer drivers that require to cover longer distances. The graph shows that as we get later into the night shift (i.e early morning) we notice the delays dropping as low as roughly 14 minutes.

## Third discussion point

## Weaknesses and next steps

Weaknesses and next steps should also be included.

\newpage

\appendix

# Appendix {-}


# Additional data details

\newpage


# References


