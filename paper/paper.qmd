---
title: "Annual Analysis of Delays in TTC Streetcars for the year 2023"
author: 
  - Aakash Vaithyanathan
thanks: "Code and data are available at: https://github.com/aakash2002/study_of_ttc_streetcar_delays"
date: today
date-format: long
abstract: "First sentence. Second sentence. Third sentence. Fourth sentence."
format: pdf
number-sections: true
bibliography: references.bib
---

```{r}
#| include: false
#| warning: false
#| message: false

library(tidyverse)
library(ggplot2)

data <- read_csv(here::here("data/analysis_data/cleaned_ttc_streetcar_delay_2023.csv"))
```


# Introduction

You can and should cross-reference sections and sub-sections. We use @citeR and @rohan.

The remainder of this paper is structured as follows. @sec-data....



# Data {#sec-data}

Some of our data is of penguins (@fig-bills), from @palmerpenguins.

```{r}
#| include: true
#| warning: false
#| message: false
#| echo: false
#| label: fig-delay-by-line
#| fig-cap: Average annual delay in minutes for each streetcar line

# Grouping and summarizing the data
grp_data <- data |> 
  group_by(line) |>
  summarise(average_delay = mean(min_delay), .groups = 'drop')

# Create the bar plot
ggplot(grp_data, aes(x = factor(line), y = average_delay)) +
  geom_bar(stat = "identity", width = 0.7, fill = 'lightblue') +
  geom_text(aes(label = round(average_delay, 2)), 
            vjust = -0.5,  # Position the text above the bar
            size = 2) +  # Adjust the size of the text
  ggtitle("Bar plot of average delay in minutes by line") +
  xlab("Streetcar Line") +
  ylab("Average Delay in Minutes") +
  theme_minimal() + 
  theme(axis.text.x = element_text(angle = 45, hjust = 1),
        title = element_text(hjust = 0.5))

```

Talk more about it.

And also planes (@fig-planes). (You can change the height and width, but don't worry about doing that until you have finished every other aspect of the paper - Quarto will try to make it look nice and the defaults usually work well once you have enough text.)

```{r}
#| label: fig-delay-for-day-shift
#| fig-cap: Average delay in minutes day shift
#| echo: false
#| warning: false
#| message: false

# Filter the data for times between 06:00 and 18:00 i.e day shift
avg_delay_day_shift <- data |> 
  group_by(hour) |>
  summarise(average_delay = mean(min_delay), .groups = 'drop') |>
  filter(hour > "06" & hour < "19")

dayshift <- ggplot(avg_delay_day_shift, aes(x = hour, y = average_delay)) +
    geom_line(color = "red", size = 1) +
    geom_point(color = "blue", size = 2) +
    ggtitle("Average delay in minutes for morning shift") +
    xlab("Hour of Day") +
    ylab("Average Delay (Minutes)") +
    theme_minimal() +
    theme(
      plot.title = element_text(hjust = 0.5),
      axis.text.x = element_text(angle = 45, hjust = 1)  # Rotate x-axis labels for clarity
    )

# Filter the data for times between 19:00 and 00:00 i.e night shift
avg_delay_night_shift <- data |> 
  group_by(hour) |>
  summarise(average_delay = mean(min_delay), .groups = 'drop') |>
  filter(hour >= "19" | hour <= "01")

nightshift <- ggplot(avg_delay_night_shift, aes(x = hour, y = average_delay)) +
    geom_line(color = "blue", size = 1) +
    geom_point(color = "red", size = 2) +
    ggtitle("Average delay in minutes for night shift") +
    xlab("Hour of Day") +
    ylab("Average Delay (Minutes)") +
    theme_minimal() +
    theme(
      plot.title = element_text(hjust = 0.5),
      axis.text.x = element_text(angle = 45, hjust = 1)  # Rotate x-axis labels for clarity
    )

dayshift
nightshift
```

Talk way more about it. 

```{r}
#| label: fig-freq-delay-incidents
#| fig-cap: Frequency plot for cause of streetcar delay by incidents
#| echo: false
#| warning: false
#| message: false

freq_incidence <- data |> 
  group_by(incident) |> 
  summarise(frequency = n(), .groups = 'drop')

ggplot(freq_incidence, aes(x = incident, y = frequency)) +
  geom_bar(stat = "identity", fill = "lightblue") +
  geom_text(aes(label = frequency), 
            vjust = -0.5,  # Position the text above the bar
            size = 2) +  # Adjust the size of the text
  ggtitle("Frequency of each delay incident in the year 2023") +
  xlab("Delay Incident Type") +
  ylab("Frequency") +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5),  # Center title
    axis.text.x = element_text(angle = 45, hjust = 1)  # Rotate x-axis labels for clarity
  )
```



```{r}
#| label: fig-min-delay-by-season
#| fig-cap: Average delay in minutes by seasons in a yea
#| echo: false
#| warning: false
#| message: false

delay_by_season <- data |>
  group_by(season) |>
  summarise(average_delay = mean(min_delay), .groups = 'drop')

ggplot(delay_by_season, aes(x = season, y = average_delay)) +
  geom_bar(stat = "identity", fill = "lightblue") +
  ggtitle("Average delay in minutes by seasons in a year") +
  xlab("Type of Season") +
  ylab("Average delay in minutes") +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5),  # Center title
    axis.text.x = element_text(angle = 45, hjust = 1)  # Rotate x-axis labels for clarity
  )
```

# Discussion

## First discussion point {#sec-first-point}

If my paper were 10 pages, then should be be at least 2.5 pages. The discussion is a chance to show off what you know and what you learnt from all this. 

## Second discussion point

## Third discussion point

## Weaknesses and next steps

Weaknesses and next steps should also be included.

\newpage

\appendix

# Appendix {-}


# Additional data details

\newpage


# References


